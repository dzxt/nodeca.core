## Queue API

### new Queue(redis, prefix)

 - **redis** (RedisClient) - redis client instance
 - **prefix** (String) - optional. Redis keys prefix, "queue:" by default

### .registerWorker(options) / .registerWorker(name [, cron], process)

Options:

 - **name** (String) - the worker's name
 - **taskID** (Function) - optional, should return new task id. Needed only for
   creating exclusive tasks, return random value by default, called as: `function (taskData)`
 - **chunksPerInstance** (Number) - optional, available count of parallel chunks in one
   process (Infinity - not restricted), default Infinity
 - **retry** (Number) - optional, number of retry on error, default 2
 - **retryDelay** (Number) - optional, delay in ms after retries, default 60000 ms
 - **timeout** (Number) - optional, `map`, `chunk` and `reduce` execution timeout, default 30000 ms
 - **cron** (String) - optional, cron string ("15 \*/6 \* \* \*"), default null
 - **map** (Function) - optional, proxy taskData to single chunk by default,
   called as: `task.map(callback)`
   - **this** (Object) - current task (task data is available as `this.data`)
   - **callback** (Function) - called as: `function (err, chunksData)`
     - **chunksData** (Array) - array of chunks data
 - **process** (Function) - called as: `chunk.process(callback)`
   - **this** (Object) - current chunk (chunk data is available as `this.data`)
   - **callback** (Function) - called as: `function (err, result)`
 - **reduce** (Function) - optional, only call `callback` by default,
   called as: `task.reduce(chunksResult, callback)`
   - **this** (Object) - current task
   - **chunksResult** (Array) - array of chunks results
   - **callback** (Function) - called as: `function (err)`

#### `map` function

This function is called when you create a new task, and it's purpose is to split input data into data chunks. By default it creates a single chunk containing input data as is.

`this` object represents a task. Structure:

 - **id** (String) - task ID, generated by `worker.taskID` on task creation
 - **data** (Object) - input data
 - **worker** (Object) - a worker instance this task corresponds to (see options above)

#### `process` function

This function is called once for each chunk returned from a `map` function.

`this` object represents a chunk. Structure:

 - **id** (String) - randomly generated chunk ID
 - **task** (Object) - a task this chunk corresponds to
   - **id** (String) - task ID, generated by `worker.taskID` on task creation
   - **worker** (Object) - a worker instance this task corresponds to (see options above)

#### `reduce` function

This function is called after all chunks are processed. This is the last step of the task execution.

`this` object represents a task. Structure:

 - **id** (String) - task ID, generated by `worker.taskID` on task creation
 - **worker** (Object) - a worker instance this task corresponds to (see options above)


### .push(workerName, taskData, callback)

Run the task immediately.

 - **workerName** (String) - the worker name
 - **taskData** (Object) - optional, the task params
 - **callback** (Function) - called as: `function (err)`

### .shutdown()

Stop accepting new tasks from queue. Active tasks continue execution.

### .on('error', callback)

`Queue` is an `EventEmitter` instance that only fires `error` event when an error has occured.

